<!-- Node Registration -->
<script type="text/javascript">
	RED.nodes.registerType('PLMConfig',{
		category: 'config',
		defaults: {
			path: { value: '', required: true }
		},
		oneditprepare: function(){
			try { $("#node-config-input-path").autocomplete( "destroy" ); }
			catch(err) { }

			$("#node-config-lookup-modems").click( _ => {

					$("#node-config-lookup-modems").addClass('disabled');

					$.getJSON('insteon-ports', data => {

							$("#node-config-lookup-modems").removeClass('disabled');

							let autoConfig = {
									source: data.map(_ => _.comName),
									minLength: 0,
									close: () => {
											$("#node-config-input-path").autocomplete( "destroy" );
									}
							};

							$("#node-config-input-path").autocomplete(autoConfig).autocomplete("search","");
					});
			});
			
			/* Get the modem's links */
			$.ajax({
				method: "post",
				dataType: "json",
				url: "insteon-plm-links",
				data: {configNodeId: configNodeId},
				success: function(data){
					console.log('ajax success',data);
				},
				error: function(error){
					// This is not conventional, but we need a way to output the sapError object to the debug window in case the ajax call fails
					// node.error() is not in context here
					RED.debug.handleDebugMessage({name:"error: read table",msg:error, level: 20});					
				}
			})
		},
		label: function() {
		}
	});
</script>

<!-- Node Configuration -->
<script type="text/x-red" data-template-name="PLMConfig">
	<div class="form-row">
		<label for="node-config-input-path">Path</label>
		<input type="text" id="node-config-input-path" style="width:66%;">
		<a id="node-config-lookup-modems" class="btn"><i id="node-config-lookup-modems-icon" class="fa fa-search"></i></a>
	</div>
</script>

<!-- Help Panel -->
<script type="text/x-red" data-help-name="PLMConfig">
	<h3>Info</h3>
	<p>Provides configuration options for a Insteon modem</p>
	<p>The search button should return a list of available Insteon PowerLinc Modems to choose from, or you can type in the location if known.</p>
	
	<h3>Example</h3>
	<p>/dev/insteon</p>
</script>